# Matching Engine Configuration
# 
# This file documents the configuration options for the chemical matching engine.
# Copy values to your .env file or use programmatically via MatcherConfig.

# ============================================================================
# EXACT MATCHING
# ============================================================================

# Enable CAS number direct lookup
MATCHER_EXACT_CAS_ENABLED=true

# Enable InChIKey identity matching
MATCHER_EXACT_INCHIKEY_ENABLED=true

# Enable normalized synonym exact matching
MATCHER_EXACT_SYNONYM_ENABLED=true


# ============================================================================
# FUZZY MATCHING
# ============================================================================

# Enable fuzzy string matching
MATCHER_FUZZY_ENABLED=true

# Minimum similarity threshold (0.0-1.0)
# Higher = stricter matching, fewer false positives
MATCHER_FUZZY_THRESHOLD=0.75

# Number of top candidates to return
MATCHER_FUZZY_TOP_K=5

# Confidence thresholds for similarity scores
MATCHER_FUZZY_HIGH_CONFIDENCE=0.95
MATCHER_FUZZY_MEDIUM_CONFIDENCE=0.85


# ============================================================================
# SEMANTIC MATCHING (FAISS)
# ============================================================================

# Enable semantic vector matching
MATCHER_SEMANTIC_ENABLED=true

# Minimum cosine similarity threshold (0.0-1.0)
MATCHER_SEMANTIC_THRESHOLD=0.75

# Number of top candidates to return
MATCHER_SEMANTIC_TOP_K=5

# Confidence thresholds for similarity scores
MATCHER_SEMANTIC_HIGH_CONFIDENCE=0.95
MATCHER_SEMANTIC_MEDIUM_CONFIDENCE=0.85

# Model configuration
EMBEDDING_MODEL_NAME=all-MiniLM-L6-v2
EMBEDDING_DIM=384
EMBEDDING_NORMALIZE_L2=true

# FAISS index paths (relative to project root)
FAISS_INDEX_PATH=data/embeddings/faiss_index.bin
VECTORS_PATH=data/embeddings/synonym_vectors.npy
METADATA_PATH=data/embeddings/index_metadata.json


# ============================================================================
# RESOLUTION ENGINE
# ============================================================================

# Disagreement penalty (0.0-1.0)
# Applied to fuzzy matches when fuzzy and semantic disagree
MATCHER_DISAGREEMENT_PENALTY=0.1

# Disagreement detection threshold
# If top fuzzy and semantic scores differ by more than this, flag disagreement
MATCHER_DISAGREEMENT_THRESHOLD=0.15

# Manual review threshold
# If best match confidence < this, flag for manual review
MATCHER_MANUAL_REVIEW_THRESHOLD=0.80


# ============================================================================
# PERFORMANCE
# ============================================================================

# Maximum allowed processing time per query (milliseconds)
MATCHER_MAX_PROCESSING_TIME_MS=50.0

# Batch size for embedding generation
EMBEDDING_BATCH_SIZE=32


# ============================================================================
# LOGGING AND AUDITING
# ============================================================================

# Log all match decisions to database
MATCHER_LOG_DECISIONS=true

# Enable detailed matching signals in logs
MATCHER_LOG_SIGNALS=true

# Corpus and model version tracking (auto-computed if not set)
# MATCHER_CORPUS_SNAPSHOT_HASH=
# MATCHER_MODEL_HASH=


# ============================================================================
# DEVELOPMENT/TESTING
# ============================================================================

# Use mock FAISS index for testing (when actual index not available)
MATCHER_USE_MOCK_INDEX=false

# Enable verbose logging
MATCHER_VERBOSE=false
